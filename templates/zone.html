<!DOCTYPE html>
<html>
<head>
    <title>{{ zone }} - Nexa Sensors</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="topbar">
    <div class="left">
        <span class="logo">Nexa Sensors</span>
        <a href="/" class="btn">Accueil</a>
    </div>
    <div class="right">
        <div class="user-dropdown">
            <span>{{ username }}</span>
            <div class="dropdown-content">
                <a href="/settings">Settings</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </div>
</div>

<h2>{{ zone }}</h2>

<form method="get" class="date-form">
    <label>Select Date:</label>
    <input type="date" name="date" value="{{ selected_date }}">
    <button type="submit">Apply</button>
</form>

<table>
    <tr>
        <th>Sensor ID</th>
        <th>Date</th>
        <th>Time</th>
        <th>Machine Status</th>
        <th>Value</th>
        <th>Daily Avg</th>
    </tr>

    {% for sensor, readings in data.items() %}
        {% set avg = (readings | map(attribute=2) | sum) / (readings | length) %}
        {% for date, time_, value, status in readings %}
            <tr>
                <td>{{ sensor }}</td>
                <td>{{ date }}</td>
                <td>{{ time_ }}</td>
                <td class="machine-status {% if status == 'ON' %}on{% else %}off{% endif %}">{{ status }}</td>
                <td>{{ value }}</td>
                <td>{{ "%.2f"|format(avg) }}</td>
            </tr>
        {% endfor %}
    {% endfor %}
</table>

</body>
</html>
